import base64
import sys
import os
import time
import random
import requests
from openpyxl import Workbook
from datetime import datetime, timedelta
from PyQt5.QtGui import QFont, QPixmap, QIcon
from PyQt5.QtCore import QThreadPool, QDateTime, QByteArray, QTime, QDate, QMutex, QSize, QRunnable, pyqtSignal, QObject, \
    QTimer, Qt
from configparser import ConfigParser
from PyQt5.QtWidgets import QApplication, QMessageBox, QDateTimeEdit, \
    QListWidget, QStackedWidget, QProgressBar, QGroupBox, QGridLayout, QListWidgetItem, \
    QVBoxLayout, QHBoxLayout, QLabel, QFrame, QWidget, QSizePolicy, QLineEdit, QPushButton


# âœ… ä¸é™åˆ¶å¹¶å‘ï¼šåªåšé”™å³°å¯åŠ¨ï¼ˆé¿å…åŒä¸€ç§’æ´ªå³°ï¼‰
STAGGER_MAX_MS = 5000  # æ¯ä¸ªå°ç»„å¯åŠ¨é”™å³° 0~5000ms


class WorkerSignals(QObject):  # å®šä¹‰ä¿¡å·ç±»ï¼Œç”¨äºçº¿ç¨‹ä¸ä¸»çº¿ç¨‹é€šä¿¡
    # âœ… æ”¹ï¼šfinished å¸¦ group_nameï¼Œä¾¿äºç»Ÿè®¡æ€»ä½“è¿›åº¦
    finished = pyqtSignal(str, str)         # (group_name, message)
    data_ready = pyqtSignal(str, list)      # (group_name, game_ids)
    # âœ… æ”¹ï¼šprogress å¸¦ group_nameï¼ˆå¹¶å‘ä¸‹é¿å…æ··ä¹±ï¼‰
    progress = pyqtSignal(str, int)         # (group_name, percent)
    status = pyqtSignal(str)                # çŠ¶æ€æ æ–‡æœ¬æ›´æ–°ä¿¡å·
    raw_count = pyqtSignal(str, int)        # åŸå§‹æ¡æ•°ï¼ˆæœªå»é‡ï¼‰ï¼Œ(group_name, raw_total)


class DataWorker(QRunnable):  # æ•°æ®å¤„ç†çº¿ç¨‹
    def __init__(self, signals, port, token, code, start_time, end_time, group_name=""):
        super().__init__()
        self.signals = signals
        self.port = port
        self.code = code
        self.token = token
        self.start_time = start_time
        self.end_time = end_time
        self.group_name = group_name      # å°ç»„åç§°
        self.game_ids = []                # å»é‡åçš„æ¸¸æˆID
        self.is_running = True            # æ§åˆ¶çº¿ç¨‹æ˜¯å¦ç»§ç»­è¿è¡Œ
        self.mutex = QMutex()             # ä¿æŠ¤æ ‡å¿—ä½çš„äº’æ–¥é”
        self.raw_total = 0                # åŸå§‹æ¡æ•°ï¼ˆæœªå»é‡ï¼‰

    def run(self):
        try:
            print(f"ğŸŸ¢ æ­£åœ¨è·å– [{self.group_name}] æ¸¸æˆæ€»äººæ•°")
            headers = {
                'Cookie': f'token={self.token}',
            }

            url = f"http://v.boinht.com:{self.port}/pp_game_log/pf_list"

            æ¸¸æˆid_set = set()
            progress = 0
            page = 1
            self.signals.status.emit(f"[{self.group_name}] æ­£åœ¨è·å–æ•°æ®...")
            self.signals.progress.emit(self.group_name, 0)

            while True:
                self.mutex.lock()
                if not self.is_running:
                    self.mutex.unlock()
                    return
                self.mutex.unlock()

                print(f"[{self.group_name}] è¯·æ±‚ç¬¬ {page} é¡µï¼Œæ¯é¡µ5~6ä¸‡æ¡æ•°æ®...")
                self.signals.status.emit(f"[{self.group_name}] æ­£åœ¨è¯·æ±‚ç¬¬ {page} é¡µ...")

                data = {
                    "channel_id": "",
                    "open_channel_id": "",
                    "pid": "",
                    "game_type": "",
                    "user_id": "",
                    "transfer_id": "",
                    "begin_time": self.start_time,
                    "end_time": self.end_time,
                    "page_size": 60000,
                    "page": page,
                    "channel_i": "",
                    "channel_ii": "",
                    "login_code": self.code,
                }

                # âœ… å¸¦é—´éš”çš„é€šç”¨é‡è¯•æœºåˆ¶
                MAX_RETRIES = 3
                retry_count = 0
                while retry_count < MAX_RETRIES:
                    try:
                        response = requests.post(url, data=data, headers=headers, timeout=30)
                        if response.status_code == 502:
                            raise requests.exceptions.HTTPError("502 Bad Gateway")
                        response.raise_for_status()
                        result = response.json().get('result', [])
                        break  # æˆåŠŸ
                    except requests.exceptions.RequestException as e:
                        retry_count += 1
                        print(f"[{self.group_name}] è¯·æ±‚å¤±è´¥ï¼ˆç¬¬ {retry_count} æ¬¡ï¼‰ï¼š{e}")
                        self.signals.status.emit(
                            f"[{self.group_name}] è¯·æ±‚å¤±è´¥ï¼ˆç¬¬ {retry_count} æ¬¡ï¼‰ï¼Œéšæœºå»¶è¿Ÿ10~20s åé‡è¯•..."
                        )
                        time.sleep(random.randint(10, 20))  # æ¯æ¬¡å¤±è´¥åéšæœºç­‰å¾… 10~20 ç§’

                else:
                    # ä¸‰æ¬¡éƒ½å¤±è´¥
                    self.signals.status.emit(f"[{self.group_name}] å¤šæ¬¡è¯·æ±‚å¤±è´¥ï¼Œè·³è¿‡è¯¥å°ç»„")
                    self.signals.progress.emit(self.group_name, 0)
                    self.signals.finished.emit(self.group_name, f"[{self.group_name}] è¯·æ±‚å¤±è´¥ï¼šç½‘ç»œå¼‚å¸¸")
                    return

                if not result:
                    print(f"[{self.group_name}] ç¬¬ {page} é¡µä¸ºç©ºï¼Œç»“æŸåˆ†é¡µè¯·æ±‚ã€‚")
                    break

                # âœ… ç»Ÿè®¡åŸå§‹æ¡æ•°ï¼ˆæœªå»é‡ï¼‰
                self.raw_total += len(result)

                for aa in result:
                    self.mutex.lock()
                    if not self.is_running:
                        self.mutex.unlock()
                        return
                    self.mutex.unlock()

                    æ¸¸æˆid = aa.get('user_id')
                    if æ¸¸æˆid:
                        æ¸¸æˆid_set.add(æ¸¸æˆid)

                if page % 2 == 0:
                    pause_time = random.randint(3, 8)
                    time.sleep(pause_time)

                page += 1
                progress = min(95, progress + random.randint(3, 7))
                self.signals.progress.emit(self.group_name, progress)

            self.game_ids = list(æ¸¸æˆid_set)

            # âœ… å‘å‡ºåŸå§‹æ¡æ•°ï¼ˆæœªå»é‡ï¼‰
            self.signals.raw_count.emit(self.group_name, self.raw_total)

            # å®ŒæˆçŠ¶æ€ä¿¡æ¯ï¼ˆå¸¦å»é‡ä¸åŸå§‹æ¡æ•°ï¼‰
            self.signals.status.emit(
                f"[{self.group_name}] æ•°æ®è·å–å®Œæˆï¼šæ¸¸æˆæ€»äººæ•° {len(self.game_ids)}ï¼Œ {self.raw_total} æ¡æ¸¸æˆæ•°æ®"
            )
            self.signals.progress.emit(self.group_name, 100)
            self.signals.data_ready.emit(self.group_name, self.game_ids)
            self.signals.finished.emit(self.group_name, f"[{self.group_name}] æ‰€æœ‰æ•°æ®å·²è·å–å®Œæˆï¼")
            print(f"âœ… å°ç»„ [{self.group_name}] ä»»åŠ¡å®Œæˆï¼Œæ¸¸æˆæ€»äººæ•° {len(self.game_ids)} ä¸ªï¼Œ {self.raw_total} æ¡æ¸¸æˆæ•°æ®")

        except Exception as e:
            self.signals.status.emit(f"[{self.group_name}] å‘ç”Ÿå¼‚å¸¸")
            self.signals.progress.emit(self.group_name, 0)
            self.signals.finished.emit(self.group_name, f"[{self.group_name}] é”™è¯¯: {e}")


class UserWindow(QWidget):  # ä¸»çª—å£ç±»
    def __init__(self):
        super().__init__()
        self.check_network_validation()
        icon_base64 = "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//8iV///Ilf//yJX//8iV///Ilf//yJW//IiV/+HGFX/FQAAAAAAAAAAAAAAACFV/ychV//OIlf/5AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIVj/PSFW/88iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV//2Ilf/ryJX/5AiV/+1Ilf/+iJX//8iV//aAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJEn/ByFW/5IiVv/+Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX/6UAAAAAAAAAAAAAAAAAAAAAAAAAACBV/xghVv/JIlf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf/TAAAAAAAAAAAAAAAAAAAAAAhWv8fIVf/3SJX//8iV///Ilf//yJX/+giVv+9IVf/oSJX/5YiV/+cIlb/tCJX/98iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yFX/84AAP8BAAAAAAAAAAAAAAAAIVn/FyJX/9wiV///Ilb/ySJV/28jVf8kAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACFS/x8hV/91Ilf/4CJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8hV//8IFf/OAAAAAAAAAAAAAAAACpV/wYiV//FIlf/rSJY/zQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACpV/wYgVv+OIlf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJW/4gAAAAAAAAAAAAAAAAAAAAAIVf/VSBT/zcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAhWf8XIlf/xSJX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AAAAAAAAIlb/dyJX//8hVv/PG1H/EwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIGD/CABV/wMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABxV/wkhV//lIVf/wh5a/xEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIVj/eiJX/5wkSf8HAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACFZ/xciVv9TAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAADAAAABgAAAAAQAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/AUBA/wQqVf8GJEn/BzNm/wUAAP8BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wEgUP8QHlX/MyJW/1MhWP9rIlf/fiNW/4whV/+SIVb/lCJX/40iVv9/I1f/ZiJW/0QgVf8YAAD/AQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACFT/y4hWf8XAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAaTf8KIlf/TCFY/6AjV//VIVf/5SJX//AiV//4Ilf//iJX//8iV///Ilf//yJX//8iVv/+Ilf/9yJX/+siV//YIlf/liNX/ywAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJFv/KiJX/9AjV/9JAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcVf8JHVf/IyFW/3whV//fIlf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJW//ghVv+gIVf/Lxdd/wsAAAAAAAAAAAAAAAAAAAAAAAAAACpV/wYkWP9AIVj/3SJX//UhWP9jAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACNU/zoiVv+UIlf/5CJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf/6iJX/54gWP9XIlP/JSBg/xAcVf8bI1X/QiFX/4oiV//iIlf//yJX//YhVv9lAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbXv8TIlf/kCJX/+giV//8Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//4iV//xIlf/4SJX/9ohV//dIlf/6iJX//wiV///Ilf//yJX//EhV/9VAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQED/BCBY/zciV//IIlf//iJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yNX/+UkV/8yAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgUP8QIVb/cyJX/+ciV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJW/8MaTf8KAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACdi/w0iV/+VIlf/9iJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX/2EAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHFX/EiNW/6EiV///Ilf//yJX//8iV///Ilf//yJX//oiV//vIlf/5yJX/+EhV//dIlf/3CNX/90iV//hIlf/6CJX//EiV//8Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf/0kBA/wQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAjWP8dIVf/qCJX//8iV///Ilf//yJX//YhV//HIVf/mSJY/3EfWP9RIFj/NyJT/yUdWP8aIVn/FydY/xoiV/8mI1j/OiNY/1chVv98Ilf/qiJX/+EiV//+Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iVv/vIlf/TAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACdO/w0hWP+aIlf/+yJX//8iV//nIVb/iyRX/zIgVf8YHFX/CQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgP8CJFv/DiJa/yUhVv9zIlf/6CJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//0iV/+YGmb/CgAAAAAAAAAAAAAAAAAAAAAAAAAAAFX/AyFW/3MiV//zIlf/2SBW/3YaWf8UAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wEcVf8SIlf/gSJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX/9giU/8lAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIFf/WCJW/8MgV/9vHVj/GgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACJb/y0iV/+tIlf/+SJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX/74AQP8EAAAAAAAAAAAAAAAAAAAAAAAAAAAgWP8gIlb/WR1Y/xoAVf8DAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIFT/QCFX/94iV//9Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX/+AiWv8lAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP8BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBA/wQiVv9TIlj/6yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yFX/+0iVv9KAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACJX/2EiV//iIlf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//YhWP9jAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP8BI1f/bCJX//EiV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//shVv90AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBA/wQhWP9jIlf/8SJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//8iV///Ilf//yJX//0hV/97AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA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AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACFX/1UiVv/PIFn/PwBA/wQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHFX/EiJX/58hVf8nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIlP/JSJV/w8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=="  # æ›¿æ¢æˆä½ çš„ base64
        icon_data = QByteArray.fromBase64(icon_base64.encode())

        # æ›´å¯é çš„å›¾æ ‡åŠ è½½æ–¹å¼
        pixmap = QPixmap()
        if not pixmap.loadFromData(icon_data, "ICO"):  # æ˜¾å¼æŒ‡å®šæ ¼å¼
            print("âŒ å›¾æ ‡åŠ è½½å¤±è´¥ï¼è¯·æ£€æŸ¥ base64 æ•°æ®æˆ–æ–‡ä»¶æ ¼å¼")
        else:
            self.setWindowIcon(QIcon(pixmap))  # è®¾ç½®çª—å£å’Œä»»åŠ¡æ å›¾æ ‡
        self.setWindowTitle("æ¸¸æˆäººæ•°ç»Ÿè®¡å·¥å…·V2.0")
        self.resize(1200, 800)

        self.groups = self.load_group_names_from_config()
        self.token_inputs = {}

        self.thread_pool = QThreadPool()
        self.workers = []

        # å¤šå°ç»„æ•°æ®å¤„ç†å˜é‡
        self.group_game_ids = {}      # ä¿å­˜æ¯ä¸ªå°ç»„çš„ game_ids
        self.group_raw_counts = {}    # ä¿å­˜æ¯ä¸ªå°ç»„çš„åŸå§‹æ¡æ•°
        self.current_group = ""

        # âœ… ä¸é™å¹¶å‘ï¼šç”¨äºæ€»ä½“è¿›åº¦
        self.total_groups = 0
        self.completed_groups = 0

        # è®¾ç½®ä¸»çª—å£æ ·å¼
        self.setStyleSheet("""
            QPushButton {
                background-color: white;            /* ç™½è‰²èƒŒæ™¯ */
                color: #3498db;                     /* è“è‰²æ–‡å­— */
                border: 1px solid #3498db;          /* è“è‰²è¾¹æ¡† */
                border-radius: 8px;                 /* åœ†è§’åŠå¾„8px */
                padding: 10px 16px;                 /* å†…è¾¹è· */
                font-size: 16px;                    /* å­—ä½“å¤§å° */
                font-weight: bold;                 /* å­—ä½“åŠ ç²— */
                letter-spacing: 0.5px;              /* å­—ç¬¦é—´è· */
            }

            QPushButton:hover {
                background-color: #ecf5fb;          /* é¼ æ ‡æ‚¬åœæ—¶æµ…è“èƒŒæ™¯ï¼ˆè§†è§‰åé¦ˆï¼‰ */
                color: #2980b9;                     /* æ‚¬åœæ—¶æ–‡å­—é¢œè‰²ç¨å¾®åŠ æ·± */
                border: 1px solid #2980b9;          /* è¾¹æ¡†é¢œè‰²ä¹Ÿç¨å¾®åŠ æ·± */
            }

            QPushButton:pressed {
                background-color: #d6eaf8;          /* æŒ‰ä¸‹æ—¶æ›´æ·±ä¸€ç‚¹çš„æµ…è“èƒŒæ™¯ */
                padding-left: 14px;                 /* æ¨¡æ‹ŸæŒ‰å‹æ„Ÿ */
                padding-top: 12px;
            }

            QPushButton:disabled {
                background-color: #f0f0f0;          /* ç¦ç”¨æ—¶èƒŒæ™¯ç°è‰² */
                color: #bdc3c7;                     /* ç¦ç”¨æ—¶å­—ä½“æµ…ç° */
                border: 1px solid #ccc;             /* è¾¹æ¡†å˜æµ…ç° */
            }

            QLineEdit, QComboBox, QDateTimeEdit {
                padding: 6px;                      /* è¾“å…¥æ§ä»¶å†…è¾¹è·ï¼ˆ6pxï¼‰ */
                border: 1px solid #ccc;            /* è¾¹æ¡†é¢œè‰²ä¸ºæµ…ç°è‰² */
                border-radius: 5px;                /* åœ†è§’ï¼ˆ5pxï¼‰ */
                font-size: 20px;                   /* å­—ä½“å¤§å°ï¼ˆ20pxï¼‰ */
            }

            QGroupBox {
                border: 1px solid #aaa;  /* ç»„æ¡†è¾¹æ¡†é¢œè‰²å’Œå®½åº¦ */
                border-radius: 8px;  /* ç»„æ¡†åœ†è§’ */
                margin-top: 6px;  /* ç»„æ¡†é¡¶éƒ¨å¤–è¾¹è· */
            }

            QGroupBox::title {
                subcontrol-origin: margin;  /* ç»„æ¡†æ ‡é¢˜åŸºäºè¾¹è·å®šä½ */
                subcontrol-position: top center;  /* ç»„æ¡†æ ‡é¢˜å±…ä¸­ */
                padding: 0 6px;  /* ç»„æ¡†æ ‡é¢˜å†…è¾¹è· */
                font-size: 15px;  /* ç»„æ¡†æ ‡é¢˜å­—ä½“å¤§å° */
                font-weight: bold;  /* ç»„æ¡†æ ‡é¢˜åŠ ç²— */
            }
        """)

        main_layout = QVBoxLayout(self)  # è®¾ç½®ä¸»å¸ƒå±€ä¸ºå‚ç›´å¸ƒå±€

        # å†…å®¹åŒºåŸŸï¼šå¯¼èˆªæ  + é¡µé¢
        content_layout = QHBoxLayout()  # æ°´å¹³å¸ƒå±€å®¹çº³å¯¼èˆªæ å’Œé¡µé¢

        # å·¦ä¾§å¯¼èˆªæ 
        self.nav_list = QListWidget()
        self.nav_list.setFixedWidth(200)  # è®¾ç½®å›ºå®šå®½åº¦
        self.nav_list.setFont(QFont("Microsoft YaHei", 11))  # è®¾ç½®å­—ä½“å’Œå¤§å°
        # è®¾ç½®å¯¼èˆªæ æ ·å¼
        self.nav_list.setStyleSheet("""
                    QListWidget {
                        background-color: #2c3e50;  /* åˆ—è¡¨æ§ä»¶èƒŒæ™¯é¢œè‰²ï¼ˆæ·±è“è‰²ï¼‰ */
                        color: #ecf0f1;            /* åˆ—è¡¨é»˜è®¤æ–‡å­—é¢œè‰²ï¼ˆæµ…ç°è‰²ï¼‰ */
                        border: none;              /* æ— è¾¹æ¡† */
                        padding-top: 15px;        /* é¡¶éƒ¨å†…è¾¹è·ï¼ˆ15pxï¼‰ */
                        outline: none;            /* ç§»é™¤ç„¦ç‚¹æ—¶çš„è™šçº¿è¾¹æ¡† */
                    }
                    QListWidget::item {
                        padding: 12px 20px;       /* åˆ—è¡¨é¡¹å†…è¾¹è·ï¼ˆä¸Šä¸‹12pxï¼Œå·¦å³20pxï¼‰ */
                        margin: 6px 10px;         /* åˆ—è¡¨é¡¹å¤–è¾¹è·ï¼ˆä¸Šä¸‹6pxï¼Œå·¦å³10pxï¼‰ */
                        font-weight: normal;      /* æ­£å¸¸å­—ä½“ç²—ç»† */
                        border-radius: 6px;       /* åˆ—è¡¨é¡¹åœ†è§’åŠå¾„ï¼ˆ6pxï¼‰ */
                    }
                    QListWidget::item:hover {
                        background-color: #3d566e;  /* é¼ æ ‡æ‚¬åœæ—¶èƒŒæ™¯é¢œè‰²ï¼ˆç¨äº®çš„è“è‰²ï¼‰ */
                        font-weight: bold;         /* æ‚¬åœæ—¶å­—ä½“åŠ ç²— */
                        color: #ffffff;            /* æ‚¬åœæ—¶æ–‡å­—é¢œè‰²ï¼ˆçº¯ç™½ï¼‰ */
                    }
                    QListWidget::item:selected {
                        background-color: #1abc9c;  /* é€‰ä¸­é¡¹èƒŒæ™¯é¢œè‰²ï¼ˆè“ç»¿è‰²ï¼‰ */
                        color: #ffffff;            /* é€‰ä¸­é¡¹æ–‡å­—é¢œè‰²ï¼ˆçº¯ç™½ï¼‰ */
                        font-weight: bold;         /* é€‰ä¸­é¡¹å­—ä½“åŠ ç²— */
                    }
                """)

        item1 = QListWidgetItem("ğŸ“Š æ•°æ®é‡‡é›†")
        item2 = QListWidgetItem("âš™ï¸ å‚æ•°é…ç½®")
        item3 = QListWidgetItem("ğŸ“˜ å…³äº")

        item1.setSizeHint(QSize(item1.sizeHint().width(), 40))
        item2.setSizeHint(QSize(item2.sizeHint().width(), 40))
        item3.setSizeHint(QSize(item3.sizeHint().width(), 40))

        self.nav_list.addItem(item1)
        self.nav_list.addItem(item2)
        self.nav_list.addItem(item3)

        self.nav_list.setCurrentRow(0)
        self.nav_list.currentRowChanged.connect(self.switch_page)

        # å³ä¾§é¡µé¢æ ˆ
        self.pages = QStackedWidget()
        self.data_tab = QWidget()
        self.config_tab = QWidget()
        self.about_tab = QWidget()
        self.pages.addWidget(self.data_tab)
        self.pages.addWidget(self.config_tab)
        self.pages.addWidget(self.about_tab)

        content_layout.addWidget(self.nav_list)
        content_layout.addWidget(self.pages)
        main_layout.addLayout(content_layout)

        # çŠ¶æ€æ ä¸è¿›åº¦æ¡
        self.status_label = QLabel("çŠ¶æ€ï¼šç­‰å¾…ä¸­")
        self.progress_bar = QProgressBar()
        self.progress_bar.setVisible(False)
        main_layout.addWidget(self.status_label)
        main_layout.addWidget(self.progress_bar)

        # é¡µé¢è®¾ç½®
        self.setup_data_tab()
        self.setup_config_tab()
        self.setup_about_tab()

        self.load_config()
        self.set_default_dates()

    def switch_page(self, index):
        self.pages.setCurrentIndex(index)

    def check_network_validation(self):
        try:
            program_id = "zb_yxrs102"  # æ¯ä¸ªç¨‹åºç”¨è‡ªå·±çš„åå­—ï¼ˆå¿…é¡»å’ŒJSONæ–‡ä»¶é‡Œçš„ key å¯¹åº”ï¼‰
            response = requests.get("http://8.210.92.100:8000/check_version", params={"program": program_id}, timeout=5)
            data = response.json()

            status = data.get("status")

            if status != "active":
                QMessageBox.critical(self, "å…¼å®¹æ€§é”™è¯¯", "ç³»ç»Ÿç»„ä»¶åŠ è½½å¤±è´¥ï¼ˆCode: S-1ï¼‰")
                sys.exit(0)

        except Exception:
            QMessageBox.critical(self, "å…¼å®¹æ€§é”™è¯¯", "ç»„ä»¶è¿æ¥å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ï¼ˆCode: S-2ï¼‰")
            sys.exit(0)

    def setup_data_tab(self):  # æ•°æ®è·å–é¡µé¢
        layout = QVBoxLayout()

        # æ–‡ä»¶ä¸çº¿ç¨‹è®¾ç½®
        file_group = QGroupBox("æ‚¨å¥½ï¼Œæ¬¢è¿ä½¿ç”¨æ¸¸æˆäººæ•°ç»Ÿè®¡å·¥å…·ï¼")
        file_layout = QVBoxLayout()

        file_group.setLayout(file_layout)
        layout.addWidget(file_group)

        # æ—¥æœŸèŒƒå›´
        date_group = QGroupBox("æ—¥æœŸèŒƒå›´é€‰æ‹©")
        date_layout = QVBoxLayout()

        self.start_time_input = QDateTimeEdit()
        self.start_time_input.setCalendarPopup(True)
        self.start_time_input.setDisplayFormat("yyyy-MM-dd HH:mm:ss")

        self.end_time_input = QDateTimeEdit()
        self.end_time_input.setCalendarPopup(True)
        self.end_time_input.setDisplayFormat("yyyy-MM-dd HH:mm:ss")

        date_layout.addWidget(QLabel("å¼€å§‹æ—¶é—´ï¼š"))
        date_layout.addWidget(self.start_time_input)
        date_layout.addWidget(QLabel("ç»“æŸæ—¶é—´ï¼š"))
        date_layout.addWidget(self.end_time_input)

        nav_layout = QHBoxLayout()

        self.prev_day_btn = QPushButton("âª ä¸Šä¸€æ—¥")
        self.prev_day_btn.clicked.connect(self.on_prev_day_clicked)
        nav_layout.addWidget(self.prev_day_btn)

        self.today_btn = QPushButton("âºï¸ å½“æ—¥")
        self.today_btn.clicked.connect(self.on_today_clicked)
        nav_layout.addWidget(self.today_btn)

        self.next_day_btn = QPushButton("ä¸‹ä¸€æ—¥ â©")
        self.next_day_btn.clicked.connect(self.on_next_day_clicked)
        nav_layout.addWidget(self.next_day_btn)

        date_layout.addLayout(nav_layout)
        date_group.setLayout(date_layout)
        layout.addWidget(date_group)

        # æ“ä½œæŒ‰é’®æ°´å¹³å¸ƒå±€
        button_layout = QHBoxLayout()

        self.get_button = QPushButton("ğŸš€ å¼€å§‹è·å–")
        self.get_button.clicked.connect(self.start_processing)
        button_layout.addWidget(self.get_button)

        self.export_button = QPushButton("ğŸ“¤ å¯¼å‡ºæ•°æ®")
        self.export_button.clicked.connect(self.export_data)
        button_layout.addWidget(self.export_button)

        layout.addSpacing(16)
        layout.addLayout(button_layout)

        self.data_tab.setLayout(layout)

        # åˆå§‹æ ·å¼è®¾ç½®
        self.highlight_selected_button(self.today_btn)

    def highlight_selected_button(self, selected_button):  # é«˜äº®é€‰ä¸­æŒ‰é’®
        buttons = [self.prev_day_btn, self.today_btn, self.next_day_btn]
        for btn in buttons:
            if btn == selected_button:
                btn.setStyleSheet("""
                    QPushButton {
                        background-color: #1DA1F2;
                        color: white;
                        border-radius: 6px;
                        padding: 8px 14px;
                        font-weight: bold;
                    }
                    QPushButton:hover {
                        background-color: #0d8ddf;
                    }
                """)
            else:
                btn.setStyleSheet("""
                    QPushButton {
                        background-color: white;
                        color: #3498db;
                        border: 1px solid #3498db;
                        border-radius: 6px;
                        padding: 8px 14px;
                        font-weight: bold;
                    }
                    QPushButton:hover {
                        background-color: #ecf5fb;
                        color: #2980b9;
                        border: 1px solid #2980b9;
                    }
                """)

    # å°è£…ç‚¹å‡»äº‹ä»¶æ–¹æ³•
    def on_prev_day_clicked(self):
        self.move_to_previous_day()
        self.highlight_selected_button(self.prev_day_btn)

    def on_today_clicked(self):
        self.set_default_dates()
        self.highlight_selected_button(self.today_btn)

    def on_next_day_clicked(self):
        self.move_to_next_day()
        self.highlight_selected_button(self.next_day_btn)

    def setup_config_tab(self):  # é…ç½®é¡µé¢
        layout = QVBoxLayout()

        config_group = QGroupBox("åˆ†ç»„ Cookie é…ç½®")
        grid = QGridLayout()

        max_rows_per_column = 8  # æ¯åˆ—æ”¾8ä¸ªå°ç»„
        for i, group in enumerate(self.groups):
            row = i % max_rows_per_column
            col = (i // max_rows_per_column) * 2  # æ¯ç»„å 2åˆ—ï¼šlabel + input

            label = QLabel(f"{group}ï¼š")
            line_edit = QLineEdit()
            line_edit.setPlaceholderText(f"è¯·è¾“å…¥{group}Cookie")
            self.token_inputs[group] = line_edit

            grid.addWidget(label, row, col)
            grid.addWidget(line_edit, row, col + 1)

        config_group.setLayout(grid)
        layout.addWidget(config_group)

        # ç«¯å£é…ç½®
        port_group = QGroupBox("åŸºç¡€å‚æ•°")
        port_layout = QVBoxLayout()

        # ç«¯å£è¾“å…¥
        port_row = QHBoxLayout()
        port_label = QLabel("ğŸŒ ç«¯å£å·")
        self.port_input = QLineEdit()
        self.port_input.setPlaceholderText("è¯·è¾“å…¥ç«¯å£å·ï¼Œä¾‹å¦‚ï¼š8080")
        port_row.addWidget(port_label)
        port_row.addWidget(self.port_input)
        port_layout.addLayout(port_row)

        # ç™»å½•ç è¾“å…¥
        code_row = QHBoxLayout()
        code_label = QLabel("ğŸ”¢ ç™»å½•ç ")
        self.code_input = QLineEdit()
        self.code_input.setPlaceholderText("è¯·è¾“å…¥å°æ˜è®¡ç®—å™¨ç™»é™†ç ")
        code_row.addWidget(code_label)
        code_row.addWidget(self.code_input)
        port_layout.addLayout(code_row)

        port_group.setLayout(port_layout)
        layout.addWidget(port_group)

        self.save_button = QPushButton("ğŸ’¾ ä¿å­˜é…ç½®")
        self.save_button.clicked.connect(self.manual_save)
        layout.addSpacing(16)
        layout.addWidget(self.save_button)

        self.config_tab.setLayout(layout)

    def setup_about_tab(self):  # å…³äºæˆ‘ä»¬é¡µé¢ï¼ˆç™½è‰²å£°æ˜æ¡†å¡«å……åˆ°åº•ï¼‰
        layout = QVBoxLayout()
        layout.setContentsMargins(12, 12, 16, 16)
        layout.setSpacing(0)

        content = QWidget()
        col = QVBoxLayout(content)
        col.setContentsMargins(0, 0, 0, 0)
        col.setSpacing(0)

        version = getattr(self, "app_version", "v1.0.2")
        update_date = getattr(self, "app_update_date", "2025-10-21")

        # æ ‡é¢˜
        title = QLabel("å…³äºæ¸¸æˆäººæ•°ç»Ÿè®¡å·¥å…·")
        title.setStyleSheet("font-size:25px; font-weight:700; color:#1f2937;")
        col.addWidget(title, 0, Qt.AlignLeft)
        col.addSpacing(15)

        # ç‰ˆæœ¬è¡Œï¼ˆå­—å·åŠ å¤§ï¼‰
        ver_row = QHBoxLayout()
        ver_row.setSpacing(8)

        ver_label = QLabel("ç‰ˆæœ¬ï¼š")
        ver_label.setStyleSheet("font-size:16px;")

        ver_value = QLabel(version)
        ver_value.setStyleSheet("font-size:16px; color:#0f766e; font-weight:600;")

        date_label = QLabel(f"  æ›´æ–°æ—¥æœŸï¼š{update_date}")
        date_label.setStyleSheet("font-size:16px; color:#64748b;")

        ver_row.addWidget(ver_label, 0, Qt.AlignLeft)
        ver_row.addWidget(ver_value, 0, Qt.AlignLeft)
        ver_row.addWidget(date_label, 0, Qt.AlignLeft)
        ver_row.addStretch(1)
        col.addLayout(ver_row)
        col.addSpacing(35)

        # â€œå£°æ˜ï¼šâ€ æ ‡é¢˜
        decl_title = QLabel("å£°æ˜ï¼š")
        decl_title.setStyleSheet("font-size:14px; font-weight:700; color:#111827;")
        col.addWidget(decl_title, 0, Qt.AlignLeft)
        col.addSpacing(12)

        # ç™½è‰²æ¡†
        box = QFrame()
        box.setStyleSheet("""
            QFrame {
                background: #ffffff;
                border-radius: 8px;
            }
        """)
        box.setSizePolicy(QSizePolicy.Expanding, QSizePolicy.Expanding)
        box_layout = QVBoxLayout(box)
        box_layout.setContentsMargins(14, 12, 14, 12)
        box_layout.setSpacing(6)

        # å£°æ˜æ­£æ–‡ï¼ˆæœ€åä¸€å¥åŠ ç²—ï¼‰
        body = QLabel(
            "<div style='color:#374151; font-size:15px; line-height:1.9;'>"
            "æœ¬è½¯ä»¶ä»…ä¾›å…·å¤‡åå°è®¿é—®æƒé™ä¸”å·²è·æˆæƒçš„ç”¨æˆ·åœ¨åˆè§„å‰æä¸‹ä½¿ç”¨ï¼Œä¸»è¦ç”¨äºé‡‡é›†æ¸¸æˆå¹³å°ç›¸å…³æ•°æ®å¹¶ç»Ÿè®¡æ¸¸æˆæ€»äººæ•°ç­‰æŒ‡æ ‡ï¼ˆä¾‹å¦‚ï¼šæ¸¸æˆæ—¥å¿—ã€ç”¨æˆ· GameIdã€åˆ†ç»„ä¿¡æ¯ç­‰ï¼‰ã€‚"
            "ä½¿ç”¨è€…åº”ç¡®è®¤/ä¿è¯æ•°æ®ä¸è´¦å·æ¥æºåˆè§„ã€æˆæƒå……åˆ†ï¼Œå¹¶å¯¹è‡ªèº«æ“ä½œåŠç»“æœæ‰¿æ‹…å…¨éƒ¨è´£ä»»ã€‚<br/><br/>"
            "å› æˆæƒä¸è¶³æˆ–è¿è§„ä½¿ç”¨å¯¼è‡´çš„ä»»ä½•æŸå¤±ã€å¤„ç½šç­‰ç”±ä½¿ç”¨è€…è‡ªè¡Œæ‰¿æ‹…ã€‚æœ¬è½¯ä»¶æŒ‰â€œç°çŠ¶â€æä¾›ï¼Œä¸ä½œä»»ä½•æ˜ç¤ºæˆ–é»˜ç¤ºæ‹…ä¿ï¼›"
            "ä½œè€…å¯¹å› ä½¿ç”¨æˆ–æ— æ³•ä½¿ç”¨æœ¬è½¯ä»¶é€ æˆçš„ä»»ä½•ç›´æ¥æˆ–é—´æ¥æŸå¤±ä¸æ‰¿æ‹…è´£ä»»ã€‚æœ¬è½¯ä»¶ä¸ç›¸å…³å¹³å°/å•†æˆ·/æ”¯ä»˜æœºæ„æ— éš¶å±æˆ–åˆä½œå…³ç³»ã€‚<br/><br/>"
            "<b>ç»§ç»­ä½¿ç”¨å³è¡¨ç¤ºæ‚¨å·²é˜…è¯»ã€ç†è§£å¹¶åŒæ„æœ¬å£°æ˜ã€‚</b>"
            "</div>"
        )
        body.setWordWrap(True)
        body.setTextFormat(Qt.RichText)
        body.setContentsMargins(0, 0, 0, 0)
        body.setMargin(0)
        box_layout.addWidget(body, 0, Qt.AlignTop)
        box_layout.addStretch(1)

        col.addWidget(box, 1)

        layout.addWidget(content, 1)
        self.about_tab.setLayout(layout)

    def set_default_dates(self):
        today = QDate.currentDate()
        self.start_time_input.setDateTime(QDateTime(today, QTime(0, 0, 0)))
        self.end_time_input.setDateTime(QDateTime(today, QTime(23, 59, 59)))

    def move_to_previous_day(self):
        date = self.start_time_input.dateTime().addDays(-1).date()
        self.start_time_input.setDateTime(QDateTime(date, QTime(0, 0, 0)))
        self.end_time_input.setDateTime(QDateTime(date, QTime(23, 59, 59)))

    def move_to_next_day(self):
        date = self.start_time_input.dateTime().addDays(1).date()
        self.start_time_input.setDateTime(QDateTime(date, QTime(0, 0, 0)))
        self.end_time_input.setDateTime(QDateTime(date, QTime(23, 59, 59)))

    # =========================
    # âœ… ä¸é™åˆ¶å¹¶å‘ï¼šä¸€æ¬¡æ€§å¯åŠ¨æ‰€æœ‰å°ç»„ï¼ˆåªé”™å³°ï¼‰
    # =========================
    def start_processing(self):  # å¼€å§‹å¤„ç†æ•°æ®
        self.group_game_ids = {}
        self.group_raw_counts = {}
        self.workers = []

        port = self.port_input.text().strip()
        code = self.code_input.text().strip()

        # æ£€æŸ¥åŸºç¡€å‚æ•°
        missing_fields = []
        if not port:
            missing_fields.append("ç«¯å£ï¼ˆportï¼‰")
        if not code:
            missing_fields.append("éªŒè¯ç ï¼ˆcodeï¼‰")
        if missing_fields:
            QMessageBox.warning(self, "è¾“å…¥é”™è¯¯", "è¯·å¡«å†™ä»¥ä¸‹å†…å®¹ï¼š\n" + "\n".join(missing_fields))
            return

        # æ£€æŸ¥æ—¶é—´è¾“å…¥ï¼ˆç›´æ¥æ¯”è¾ƒ QDateTime æ›´ç¨³å¦¥ï¼‰
        if self.end_time_input.dateTime() < self.start_time_input.dateTime():
            QMessageBox.warning(self, 'è­¦å‘Š', 'ç»“æŸæ—¶é—´ä¸èƒ½æ—©äºå¼€å§‹æ—¶é—´')
            return

        # æ—¶é—´æˆ³è½¬æ¢
        start = self.start_time_input.dateTime().toString("yyyy-MM-dd HH:mm:ss")
        end = self.end_time_input.dateTime().toString("yyyy-MM-dd HH:mm:ss")
        self.start_datetime = datetime.strptime(start, '%Y-%m-%d %H:%M:%S')
        self.end_datetime = datetime.strptime(end, '%Y-%m-%d %H:%M:%S')

        start_time = int(self.start_datetime.timestamp())
        end_time = int(self.end_datetime.timestamp())

        # âœ… åªè·‘å¡«å†™äº† Cookie çš„ç»„
        groups_to_run = []
        skipped = []
        for g in list(self.token_inputs.keys()):
            token = self.token_inputs[g].text().strip()
            if token:
                groups_to_run.append(g)
            else:
                skipped.append(g)

        if not groups_to_run:
            QMessageBox.warning(self, "è­¦å‘Š", "æ²¡æœ‰ä»»ä½•å°ç»„å¡«å†™ Cookieï¼Œæ— æ³•å¼€å§‹ï¼")
            return

        if skipped:
            print("âš ï¸ ä»¥ä¸‹å°ç»„æœªå¡«å†™ Cookieï¼Œå·²è·³è¿‡ï¼š", "ã€".join(skipped))

        # âœ… å…³é”®ï¼šçº¿ç¨‹æ± æœ€å¤§çº¿ç¨‹æ•° = è¦è·‘çš„å°ç»„æ•°ï¼ˆçœŸæ­£â€œä¸é™å¹¶å‘â€ï¼‰
        self.thread_pool.setMaxThreadCount(len(groups_to_run))

        # âœ… æ€»ä½“è¿›åº¦ï¼ˆå®Œæˆç»„æ•°ï¼‰
        self.total_groups = len(groups_to_run)
        self.completed_groups = 0

        self.status_label.setText(f"çŠ¶æ€ï¼šå‡†å¤‡å¼€å§‹â€¦ï¼ˆå…± {self.total_groups} ä¸ªå°ç»„ï¼ŒåŒæ—¶å¹¶å‘ï¼‰")
        self.progress_bar.setVisible(True)
        self.progress_bar.setValue(0)

        self.disable_ui()

        # âœ… å…¨éƒ¨æŠ•æ”¾ï¼šé”™å³°å¯åŠ¨ 0~STAGGER_MAX_MS
        for group in groups_to_run:
            delay = random.randint(0, STAGGER_MAX_MS)
            print(f"ğŸš€ å‡†å¤‡å¯åŠ¨å°ç»„ [{group}]ï¼Œé”™å³°å»¶è¿Ÿ {delay}ms")
            QTimer.singleShot(delay, lambda g=group: self._start_worker(g, port, code, start_time, end_time))

    def _start_worker(self, group, port, code, start_time, end_time):
        token = self.token_inputs[group].text().strip()
        if not token:
            # ç†è®ºä¸ä¼šå‘ç”Ÿï¼ˆå› ä¸ºå‰é¢è¿‡æ»¤è¿‡ï¼‰ï¼Œä½†è¿™é‡Œé˜²å¾¡ä¸€ä¸‹
            print(f"âš ï¸ å°ç»„ [{group}] å¯åŠ¨æ—¶å‘ç° Cookie ä¸ºç©ºï¼Œè·³è¿‡")
            self._mark_group_done(group, f"[{group}] Cookie ä¸ºç©ºï¼Œå·²è·³è¿‡")
            return

        self.current_group = group
        self.status_label.setText(f"æ­£åœ¨å¤„ç†å°ç»„ï¼š{group}")

        signals = WorkerSignals()
        worker = DataWorker(signals, port, token, code, start_time, end_time, group_name=group)
        self.workers.append(worker)

        signals.finished.connect(self.on_task_finished)
        signals.data_ready.connect(self.on_data_ready)
        signals.progress.connect(self.update_progress)   # å•ç»„è¿›åº¦ï¼šä»…åšçŠ¶æ€å±•ç¤ºï¼Œä¸é©±åŠ¨æ€»è¿›åº¦æ¡
        signals.status.connect(self.update_status)
        signals.raw_count.connect(self.on_raw_count)

        self.thread_pool.start(worker)
        print(f"ğŸ§µ å·²å¯åŠ¨çº¿ç¨‹ä»»åŠ¡ï¼š[{group}]")

    def on_raw_count(self, group_name: str, raw_count: int):
        self.group_raw_counts[group_name] = raw_count
        # print(f"ğŸ“¦ åŸå§‹æ¡æ•° [{group_name}] = {raw_count}")

    def update_status(self, message):
        self.status_label.setText(f"çŠ¶æ€ï¼š{message}")

    def update_progress(self, group_name, value):
        # âœ… å¹¶å‘ä¸‹ä¸å†ç”¨è¿™ä¸ªå»â€œæ§åˆ¶æ€»è¿›åº¦æ¡â€ï¼Œå¦åˆ™ä¼šä¹±è·³
        # è¿™é‡Œåªç”¨æ¥è¾…åŠ©æ˜¾ç¤ºçŠ¶æ€ï¼ˆå¯æ³¨é‡Š/å¯ä¿ç•™ï¼‰
        if value < 100:
            self.status_label.setText(f"çŠ¶æ€ï¼š[{group_name}] è¿›åº¦ {value}% ...")
        else:
            self.status_label.setText(f"çŠ¶æ€ï¼š[{group_name}] è¿›åº¦ 100% âœ…")

    def on_data_ready(self, group_name, game_ids):
        self.group_game_ids[group_name] = game_ids
        print(f"ğŸ“¦ å·²ä¿å­˜ [{group_name}] çš„æ¸¸æˆæ€»äººæ•° {len(game_ids)} ä¸ª")

    def _mark_group_done(self, group_name, message):
        # ç»Ÿä¸€å®Œæˆé€»è¾‘ï¼ˆç”¨äºè·³è¿‡/å¼‚å¸¸ä¹Ÿèƒ½è®¡å…¥æ€»ä½“å®Œæˆï¼‰
        self.completed_groups += 1
        if self.total_groups > 0:
            percent = int((self.completed_groups / self.total_groups) * 100)
            self.progress_bar.setValue(max(0, min(100, percent)))

        self.status_label.setText(f"çŠ¶æ€ï¼š{message}ï¼ˆå®Œæˆ {self.completed_groups}/{self.total_groups}ï¼‰")

        if self.completed_groups >= self.total_groups:
            print("ğŸ“¦ æ‰€æœ‰å°ç»„æ•°æ®å·²å¤„ç†å®Œæ¯•ï¼")
            QMessageBox.information(self, "å®Œæˆ", "æ‰€æœ‰å°ç»„æ•°æ®å·²å¤„ç†å®Œæ¯•ï¼")
            self.enable_ui()
            QTimer.singleShot(500, lambda: self.progress_bar.setVisible(False))

    def on_task_finished(self, group_name, message):
        print(message)
        self._mark_group_done(group_name, message)

    def export_data(self):
        if not self.group_game_ids:
            QMessageBox.warning(self, "è­¦å‘Š", "æ²¡æœ‰æ•°æ®å¯å¯¼å‡ºï¼")
            return

        try:
            wb = Workbook()
            wb.remove(wb.active)  # åˆ é™¤é»˜è®¤sheet

            # â€”â€” å·¥ä½œè¡¨0ï¼šæ•´åˆå½’æ€» â€”â€”
            ws_all = wb.create_sheet(title="æ•´åˆå½’æ€»")
            # è¡¨å¤´
            ws_all['A1'] = 'GameId'
            ws_all['B1'] = 'Source'
            ws_all['D1'] = 'æ¸¸æˆæ€»äººæ•°'
            ws_all['E1'] = 'æ•°æ®æ€»æ¡æ•°'  # âœ… æ–°å¢

            # ç»Ÿè®¡æ€»æ•°ï¼ˆæ³¨æ„ï¼šè¿™é‡Œä»æ˜¯â€œå„ç»„å»é‡åäººæ•°ç›¸åŠ â€ï¼Œä¸æ˜¯å…¨å±€å»é‡ï¼‰
            total_unique = sum(len(id_list) for id_list in self.group_game_ids.values())
            total_raw = sum(self.group_raw_counts.get(group, len(id_list))
                            for group, id_list in self.group_game_ids.items())

            ws_all['D2'] = total_unique
            ws_all['E2'] = total_raw  # âœ… æ–°å¢

            # æ•°æ®ä»ç¬¬2è¡Œå¼€å§‹å†™
            all_row = 2
            for group, id_list in self.group_game_ids.items():
                for gid in id_list:
                    ws_all[f"A{all_row}"] = gid
                    ws_all[f"B{all_row}"] = group
                    all_row += 1

                # â€”â€” æ¯ä¸ªå°ç»„ä¸€ä¸ªè¡¨ï¼ˆåŒæ ·çš„è¡¨å¤´ä¸å¸ƒå±€ï¼‰ â€”â€”
                ws = wb.create_sheet(title=group[:31])  # Excel sheetåæœ€å¤š31å­—ç¬¦
                ws['A1'] = 'GameId'
                ws['B1'] = 'Source'
                ws['D1'] = 'æ¸¸æˆæ€»äººæ•°'
                ws['E1'] = 'æ•°æ®æ€»æ¡æ•°'  # âœ… æ–°å¢
                ws['D2'] = len(id_list)
                ws['E2'] = self.group_raw_counts.get(group, len(id_list))  # âœ… è¯¥ç»„åŸå§‹æ¡æ•°ï¼ˆæœªå»é‡ï¼‰

                # æ•°æ®ä»ç¬¬2è¡Œå¼€å§‹å†™
                for i, gid in enumerate(id_list, start=2):
                    ws[f"A{i}"] = gid
                    ws[f"B{i}"] = group

            rq = datetime.now().strftime('%Yå¹´%mæœˆ%dæ—¥%Hæ—¶%Måˆ†%Sç§’')
            file_name = f'å¤šå°ç»„æ¸¸æˆæ€»äººæ•°_{rq}.xlsx'
            wb.save(file_name)

            QMessageBox.information(self, "æç¤º", f"æ•°æ®å·²å¯¼å‡ºåˆ° {file_name}")
            os.startfile(file_name)

        except Exception as e:
            QMessageBox.warning(self, "è­¦å‘Š", f"å¯¼å‡ºæ•°æ®å¤±è´¥: {e}")

    def disable_ui(self):
        self.start_time_input.setEnabled(False)
        self.end_time_input.setEnabled(False)
        self.get_button.setEnabled(False)
        self.export_button.setEnabled(False)
        self.prev_day_btn.setEnabled(False)
        self.today_btn.setEnabled(False)
        self.next_day_btn.setEnabled(False)

        self.save_button.setEnabled(False)
        # âœ… ç¦ç”¨æ‰€æœ‰ Cookie è¾“å…¥æ¡†
        for le in self.token_inputs.values():
            le.setEnabled(False)

    def enable_ui(self):
        self.start_time_input.setEnabled(True)
        self.end_time_input.setEnabled(True)
        self.get_button.setEnabled(True)
        self.export_button.setEnabled(True)
        self.prev_day_btn.setEnabled(True)
        self.today_btn.setEnabled(True)
        self.next_day_btn.setEnabled(True)

        self.save_button.setEnabled(True)
        # âœ… æ¢å¤æ‰€æœ‰ Cookie è¾“å…¥æ¡†
        for le in self.token_inputs.values():
            le.setEnabled(True)

    def load_group_names_from_config(self):
        config = ConfigParser()
        config.read('config.ini', encoding='utf-8')  # æŒ‡å®š UTF-8ï¼Œæ”¯æŒä¸­è‹±æ–‡
        if 'GROUP_COOKIES' in config:
            return list(config['GROUP_COOKIES'].keys())
        return ["lvcha", "yaoji", "sejie", "aisebo", "xingf", "shaonv", "renqi", "lemi", "cshuang", "zhifu"]

    def save_config(self, port, token_dict, code):
        config = ConfigParser()
        config['COMMON'] = {'Port': port, 'Code': code}
        config['GROUP_COOKIES'] = {group: token for group, token in token_dict.items()}
        with open('config.ini', 'w') as configfile:
            config.write(configfile)

    def load_config(self):
        config = ConfigParser()
        config.read('config.ini')
        if 'COMMON' in config:
            self.port_input.setText(config['COMMON'].get('Port', ''))
            self.code_input.setText(config['COMMON'].get('Code', ''))
        if 'GROUP_COOKIES' in config:
            for group in self.groups:
                if group in config['GROUP_COOKIES']:
                    self.token_inputs[group].setText(config['GROUP_COOKIES'][group])

    def manual_save(self):  # æ‰‹åŠ¨ä¿å­˜é…ç½®
        port = self.port_input.text()
        code = self.code_input.text()

        token_dict = {}
        missing_groups = []

        for group, input_field in self.token_inputs.items():
            token = input_field.text()
            if token:
                token_dict[group] = token
                input_field.setStyleSheet("")
            else:
                missing_groups.append(group)
                input_field.setStyleSheet("border: 1px solid red;")

        if not port or not code:
            QMessageBox.warning(self, "è­¦å‘Š", "è¯·å¡«å†™å®Œæ•´çš„é…ç½®ï¼ˆportå’Œcodeï¼‰ï¼")
            return

        self.save_config(port, token_dict, code)

        if missing_groups:
            missing_text = "ã€".join(missing_groups)
            QMessageBox.information(self, "éƒ¨åˆ†ä¿å­˜æˆåŠŸ", f"é…ç½®å·²ä¿å­˜ï¼Œä½†ä»¥ä¸‹å°ç»„æœªå¡«å†™ Cookieï¼š{missing_text}")
        else:
            QMessageBox.information(self, "æç¤º", "âœ… é…ç½®å·²å®Œæ•´ä¿å­˜ï¼")


if __name__ == "__main__":
    app = QApplication(sys.argv)
    window = UserWindow()
    window.show()
    sys.exit(app.exec_())
